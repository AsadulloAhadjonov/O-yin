<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Dodger ‚Äî HTML O‚Äòyin</title>
  <style>
    :root{
      --bg:#0b1020;--fg:#eaf2ff;--sub:#93c5fd;--accent:#60a5fa;--danger:#f43f5e;--ok:#34d399;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 50% 30%,#111b3a, var(--bg));color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .wrap{display:flex;align-items:center;justify-content:center;min-height:100%;padding:16px}
    .game{width:min(92vw,720px);}
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .title{font-weight:800;letter-spacing:.3px}
    .pill{display:inline-flex;gap:8px;align-items:center;background:#0f172a88;color:var(--fg);border:1px solid #1d2a53;border-radius:999px;padding:6px 12px;font-size:12px}
    canvas{width:100%;aspect-ratio:9/16;border-radius:20px;background:linear-gradient(180deg,#0b122a 0%,#060a1a 100%);box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 0 40px #0b1d47}
    .hud{display:grid;grid-template-columns:1fr auto;gap:8px;margin-top:8px;align-items:center}
    .btn{border:none;border-radius:14px;padding:10px 14px;font-weight:700;background:#0f172a;color:var(--fg);cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.25);transition:.2s transform,.2s opacity}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg,var(--accent),#2563eb);color:white}
    .btn.ghost{background:#0b122a}
    .hint{opacity:.7;font-size:12px}

    /* Start overlay */
    .overlay{position:relative}
    .panel{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px;text-align:center;border-radius:20px;background:linear-gradient(180deg,rgba(2,6,23,.85),rgba(2,6,23,.75));backdrop-filter:blur(6px)}
    .panel h1{margin:0 0 8px;font-size:28px}
    .panel p{opacity:.85;margin:4px 0}
    .chips{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .chip{padding:8px 12px;border-radius:999px;background:#0f172a;border:1px solid #1d2a53;cursor:pointer;font-size:12px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0b122a;border:1px solid #1d2a53;border-bottom-width:3px;border-radius:8px;padding:2px 6px}

    /* Mobile controls */
    .controls{display:none;grid-template-columns:repeat(3,1fr);gap:8px;position:absolute;inset:auto 0 10px 0;padding:0 10px}
    .cbtn{user-select:none;touch-action:manipulation;background:#0f172acc;border:1px solid #1d2a53;color:#e5edff;padding:14px;border-radius:12px;font-weight:700}
    .cbtn:active{transform:translateY(1px)}
    @media (max-width: 820px){
      .controls{display:grid}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game">
      <div class="topbar">
        <div class="pill"><span class="title">üöÄ Space Dodger</span></div>
        <div class="pill"><span id="best">Rekor: 0</span></div>
      </div>
      <div class="overlay">
        <canvas id="game" width="405" height="720" aria-label="Space Dodger o‚Äòyini"></canvas>
        <div class="controls" id="controls">
          <button class="cbtn" data-dir="left">‚óÄÔ∏è</button>
          <button class="cbtn" data-dir="up">üîº</button>
          <button class="cbtn" data-dir="right">‚ñ∂Ô∏è</button>
          <div></div>
          <button class="cbtn" data-dir="down">üîΩ</button>
          <button class="cbtn" id="dash">‚ö°</button>
        </div>
        <div class="panel" id="panel">
          <h1>Space Dodger</h1>
          <p>Asteroidlardan qoching, yulduzlarni to‚Äòplang!</p>
          <p class="hint">Kompyuterda: <span class="kbd">‚Üê ‚Üë ‚Üí ‚Üì</span> harakat, <span class="kbd">Space</span> ‚Äî dash.</p>
          <p class="hint">Telefonda: pastdagi tugmalar.</p>
          <div class="chips">
            <button class="btn primary" id="start">Boshlash</button>
            <button class="btn ghost" id="how">Qanday o‚Äòynash?</button>
          </div>
        </div>
      </div>
      <div class="hud">
        <div class="pill"><span>Hisob: <b id="score">0</b></span></div>
        <div class="pill"><button class="btn" id="pause">‚è∏ Pauza</button> <button class="btn" id="restart">üîÑ Qayta</button></div>
      </div>
      <p class="hint">Maslahat: Yulduz (‚òÖ) 10 ball, yashil kapsula qalqon beradi. Tezlik vaqt o‚Äòtishi bilan oshadi.</p>
    </div>
  </div>

  <script>
  // --- Yadro sozlamalar
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const panel = document.getElementById('panel');
  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best');
  const pauseBtn = document.getElementById('pause');
  const restartBtn = document.getElementById('restart');
  const startBtn = document.getElementById('start');
  const howBtn = document.getElementById('how');
  const controls = document.getElementById('controls');

  let W = canvas.width, H = canvas.height;
  let running = false, paused = false;
  let t = 0, score = 0, best = +localStorage.getItem('sd_best')||0;
  bestEl.textContent = 'Rekor: '+best;

  const rnd = (a,b)=>Math.random()*(b-a)+a;

  const keys = new Set();
  window.addEventListener('keydown',e=>{
    if(['ArrowLeft','ArrowRight','ArrowUp','ArrowDown',' '].includes(e.key)) e.preventDefault();
    keys.add(e.key);
    if(e.key==='p' || e.key==='P') togglePause();
  });
  window.addEventListener('keyup',e=>keys.delete(e.key));

  // Mobil boshqaruvlar
  controls.addEventListener('touchstart', e=>{
    const target = e.target.closest('[data-dir]');
    if(!target) return;
    e.preventDefault();
    const dir=target.dataset.dir;
    if(dir==='left') keys.add('ArrowLeft');
    if(dir==='right') keys.add('ArrowRight');
    if(dir==='up') keys.add('ArrowUp');
    if(dir==='down') keys.add('ArrowDown');
  }, {passive:false});
  controls.addEventListener('touchend', e=>{
    keys.delete('ArrowLeft');keys.delete('ArrowRight');keys.delete('ArrowUp');keys.delete('ArrowDown');
  });
  document.getElementById('dash').addEventListener('click',()=>dash());

  // O‚Äòyin obyektlari
  const player = {x:W/2, y:H*0.8, r:12, vx:0, vy:0, speed:3.2, dashCD:0, shield:0};
  const rocks = []; // dushmanlar
  const stars = []; // ball uchun
  const powerups = []; // qalqon

  function reset(){
    t=0; score=0; rocks.length=0; stars.length=0; powerups.length=0; paused=false; running=true; player.x=W/2; player.y=H*0.8; player.vx=player.vy=0; player.dashCD=0; player.shield=0;
  }

  function spawn(){
    // tezlik va zichlik vaqt bilan oshadi
    const level = 1 + Math.min(3, Math.floor(t/1500));
    if(Math.random()<0.06+level*0.01){
      rocks.push({x:rnd(20,W-20), y:-20, r:rnd(10,24+level*6), vy:rnd(1.5,2.8+level)});
    }
    if(Math.random()<0.03){
      stars.push({x:rnd(16,W-16), y:-10, r:6, vy:rnd(1.6,2.4)});
    }
    if(Math.random()<0.005){
      powerups.push({x:rnd(16,W-16), y:-12, r:8, vy:rnd(1.6,2.2)});
    }
  }

  function input(){
    const acc = player.speed;
    player.vx = (keys.has('ArrowLeft')?-acc:0) + (keys.has('ArrowRight')?acc:0);
    player.vy = (keys.has('ArrowUp')?-acc*0.9:0) + (keys.has('ArrowDown')?acc*0.9:0);
    player.x += player.vx; player.y += player.vy;
    player.x = Math.max(player.r, Math.min(W-player.r, player.x));
    player.y = Math.max(player.r, Math.min(H-player.r, player.y));

    if(keys.has(' ')) dash();
  }

  function dash(){
    if(player.dashCD>0) return;
    player.dashCD = 120; // cooldown freymlar
    const fx = (keys.has('ArrowRight')?1:0) - (keys.has('ArrowLeft')?1:0);
    const fy = (keys.has('ArrowDown')?1:0) - (keys.has('ArrowUp')?1:0);
    const mag = Math.hypot(fx,fy)||1;
    player.x += (fx/mag)*80; player.y += (fy/mag)*80;
    // cheklash
    player.x = Math.max(player.r, Math.min(W-player.r, player.x));
    player.y = Math.max(player.r, Math.min(H-player.r, player.y));
    // kichik effekt
    for(let i=0;i<12;i++) particles.push({x:player.x,y:player.y, vx:rnd(-2,2), vy:rnd(-2,2), life:30, color:'#93c5fd'});
  }

  // Zarralar (vizual)
  const particles = [];
  function drawParticles(){
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.life--; if(p.life<=0) particles.splice(i,1);
      ctx.globalAlpha=Math.max(0, p.life/30);
      ctx.fillStyle=p.color||'#fff';
      ctx.fillRect(p.x,p.y,2,2);
      ctx.globalAlpha=1;
    }
  }

  function update() {
    if(!running || paused) return;
    t++;
    if(player.dashCD>0) player.dashCD--;

    input(); spawn();

    // yulduzlar
    for(let i=stars.length-1;i>=0;i--){
      const s=stars[i]; s.y+=s.vy; if(s.y>H+12) stars.splice(i,1);
      if(collide(player,s)) {stars.splice(i,1); score+=10; bump();}
    }
    // power-up (qalqon)
    for(let i=powerups.length-1;i>=0;i--){
      const p=powerups[i]; p.y+=p.vy; if(p.y>H+12) powerups.splice(i,1);
      if(collide(player,p)) {powerups.splice(i,1); player.shield=300; flash('#34d399');}
    }
    // dushmanlar
    const speedScale = 1+Math.min(1.2, t/3600);
    for(let i=rocks.length-1;i>=0;i--){
      const r=rocks[i]; r.y+=r.vy*speedScale; if(r.y>H+30) rocks.splice(i,1);
      if(collide(player,r)){
        if(player.shield>0){
          player.shield-=120; rocks.splice(i,1); flash('#22c55e');
        } else {
          gameOver(); return;
        }
      }
    }
    if(player.shield>0) player.shield--;

    score += 0.05; // tirik qolish uchun ham ball
    scoreEl.textContent = Math.floor(score);
    draw();
    requestAnimationFrame(update);
  }

  function draw(){
    // fon ‚Äî yulduzlar oqimi
    ctx.clearRect(0,0,W,H);
    for(let i=0;i<4;i++){
      ctx.fillStyle = `rgba(255,255,255,${0.04+i*0.01})`;
      for(let j=0;j<40;j++){
        const x=((j*97+i*33+t*0.6)%W); const y=((j*61+i*13+t*2)%H);
        ctx.fillRect(x, y, 2, 2);
      }
    }

    // o‚Äòyinchi ‚Äî uchburchak kema
    ctx.save();
    ctx.translate(player.x, player.y);
    ctx.rotate(Math.atan2(player.vy, player.vx)+Math.PI/2);
    ctx.fillStyle = player.shield>0 ? '#a7f3d0' : '#93c5fd';
    ctx.beginPath();
    ctx.moveTo(0,-player.r-4);
    ctx.lineTo(player.r, player.r);
    ctx.lineTo(-player.r, player.r);
    ctx.closePath();
    ctx.fill();
    // dvigatel ishi
    ctx.fillStyle = '#60a5fa';
    ctx.fillRect(-3, player.r-1, 6, 8);
    ctx.restore();

    // obyektlar
    ctx.fillStyle = '#fcd34d';
    stars.forEach(s=>{starShape(s.x,s.y,s.r)});

    ctx.fillStyle = '#34d399';
    powerups.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();ctx.fillRect(p.x-1,p.y-p.r-6,2,8)});

    ctx.fillStyle = '#f43f5e';
    rocks.forEach(r=>{ctx.beginPath();ctx.arc(r.x,r.y,r.r,0,Math.PI*2);ctx.fill()});

    drawParticles();

    // UI
    if(paused){
      overlayText('PAUZA', 'Davom ettirish uchun P yoki Pauza tugmasi');
    }
  }

  function starShape(x,y,r){
    ctx.save();
    ctx.translate(x,y);
    ctx.beginPath();
    for(let i=0;i<5;i++){
      const angle = i*Math.PI*2/5 - Math.PI/2;
      ctx.lineTo(Math.cos(angle)*r, Math.sin(angle)*r);
      const angle2 = angle + Math.PI/5;
      ctx.lineTo(Math.cos(angle2)*r*0.5, Math.sin(angle2)*r*0.5);
    }
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  function collide(a,b){
    const d = Math.hypot(a.x-b.x, a.y-b.y);
    return d < (a.r + b.r);
  }

  function bump(){
    for(let i=0;i<8;i++) particles.push({x:player.x,y:player.y, vx:rnd(-1.5,1.5), vy:rnd(-1.5,1.5), life:24, color:'#fcd34d'});
  }
  function flash(color){
    for(let i=0;i<18;i++) particles.push({x:player.x,y:player.y, vx:rnd(-2,2), vy:rnd(-2,2), life:26, color});
  }

  function overlayText(title, sub){
    ctx.fillStyle='rgba(2,6,23,.72)';
    ctx.fillRect(20,H/2-60,W-40,120);
    ctx.strokeStyle='#1d2a53'; ctx.strokeRect(20,H/2-60,W-40,120);
    ctx.fillStyle='white'; ctx.font='bold 28px system-ui'; ctx.textAlign='center';
    ctx.fillText(title, W/2, H/2-10);
    ctx.font='14px system-ui'; ctx.globalAlpha=0.9; ctx.fillText(sub, W/2, H/2+18); ctx.globalAlpha=1;
  }

  function gameOver(){
    running=false;
    best = Math.max(best, Math.floor(score));
    localStorage.setItem('sd_best', best);
    bestEl.textContent = 'Rekor: '+best;
    panel.style.display='flex';
    panel.innerHTML = `
      <h1>O‚Äòyin tugadi</h1>
      <p>Hisob: <b>${Math.floor(score)}</b> ‚Ä¢ Rekor: <b>${best}</b></p>
      <div class="chips">
        <button class="btn primary" id="again">Yana o‚Äòynash</button>
        <button class="btn ghost" id="share">Natijani ulash</button>
      </div>
    `;
    document.getElementById('again').onclick=()=>{panel.innerHTML=origPanel; startGame();};
    document.getElementById('share').onclick=()=>{
      const txt=`Space Dodger: mening hisobim ${Math.floor(score)}! Sen ham urinib ko‚Äòr üöÄ`;
      if(navigator.share){navigator.share({title:'Space Dodger', text:txt});}
      else {navigator.clipboard.writeText(txt); alert('Matn nusxalandi!');}
    };
  }

  function togglePause(){
    if(!running) return;
    paused=!paused;
    pauseBtn.textContent = paused? '‚ñ∂Ô∏è Davom et' : '‚è∏ Pauza';
    if(!paused) requestAnimationFrame(update);
  }

  function startGame(){
    reset(); panel.style.display='none'; requestAnimationFrame(update);
  }

  // Panel kontenti (qayta tiklash uchun saqlab qo‚Äòyamiz)
  const origPanel = panel.innerHTML;

  // Tugmalar
  pauseBtn.onclick=togglePause;
  restartBtn.onclick=()=>{panel.innerHTML=origPanel; startGame();}
  startBtn.onclick=()=>startGame();
  howBtn.onclick=()=>{
    panel.innerHTML = `
      <h1>Qanday o‚Äòynash?</h1>
      <p>‚Üê ‚Üë ‚Üí ‚Üì ‚Äî harakat. <span class="kbd">Space</span> ‚Äî <b>Dash</b> (tez sakrash).</p>
      <p>‚òÖ yulduz = +10 ball. Yashil kapsula ‚Äî <b>qalqon</b> (zarbani yutadi).</p>
      <p>Vaqt o‚Äòtishi bilan asteroidlar ko‚Äòpayadi va tezlashadi.</p>
      <div class="chips">
        <button class="btn primary" id="back">Tushunarli</button>
      </div>`;
    document.getElementById('back').onclick=()=>{panel.innerHTML=origPanel};
  }

  // Responsive: canvaska moslash
  function resize(){
    const ratio = 9/16; // 405x720
    const rect = canvas.getBoundingClientRect();
    // Rasm chizish o‚Äòlchami sifatini saqlash uchun pixelRatio
    const pr = Math.min(window.devicePixelRatio||1, 2);
    W = Math.floor(rect.width*pr);
    H = Math.floor(rect.width/ratio*pr);
    canvas.width = W; canvas.height = H;
    if(!running) draw();
  }
  new ResizeObserver(resize).observe(canvas);
  resize();

  // Boshlang‚Äòich chizish
  draw();
  </script>
</body>
</html>
